<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>preopercionales combuses</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0d6efd" />
  <style>
    :root{
      --bg: linear-gradient(135deg,#eef2ff 0%,#f7f9ff 50%,#eef6ff 100%);
      --ink:#0b1022; --muted:#6b7280; --card:#ffffff; --ring:#dbe4ff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg); color:var(--ink);
    }
    header{
      position:sticky; top:0; background:rgba(255,255,255,.85); backdrop-filter:blur(8px);
      border-bottom:1px solid #e5e7eb; padding:10px 16px; z-index:10
    }
    .title{font-weight:600}
    .wrap{
      max-width:1100px; margin:auto; padding:10px; display:grid; gap:10px;
      height: calc(100vh - 60px);
    }
    .frame-wrap{
      background:var(--card); border:1px solid #e5e7eb; border-radius:16px;
      box-shadow:0 10px 30px rgba(2,8,20,.08); overflow:hidden; position:relative;
      height: 100%;
    }
    iframe{
      display:block; width:100%; border:0;
      /* Scroll suave para móviles */
      overflow-y: auto !important;
      -webkit-overflow-scrolling: touch !important;
      overscroll-behavior: contain;
      height: 100%;
      min-height: 100%;
    }
    .loader{
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
      background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.6));
      transition:opacity .25s ease; pointer-events:none;
    }
    body.ready .loader{ opacity:0; }
    .spinner{
      width:36px; height:36px; border-radius:50%;
      border:3px solid #c7d2fe; border-top-color:#4f46e5; animation:spin 1s linear infinite;
    }
    @keyframes spin { to { transform:rotate(360deg) } }
    .hint{font-size:12px; color:var(--muted); text-align:center; padding:6px 0 10px}
    a.btn{
      display:inline-block; padding:8px 12px; border:1px solid #c7d2fe; border-radius:10px; text-decoration:none;
      color:#1d4ed8; background:#eef2ff;
    }

    /* Optimizaciones para móviles */
    @media (max-width: 768px) {
      .wrap {
        padding: 0;
        max-width: 100%;
        height: calc(100vh - 50px);
      }
      
      .frame-wrap {
        border-radius: 0;
        border: none;
        box-shadow: none;
        height: 100%;
      }
      
      header {
        padding: 8px 12px;
      }
      
      iframe {
        border-radius: 0;
      }
    }

    /* Para pantallas muy pequeñas */
    @media (max-width: 480px) {
      .wrap {
        height: calc(100vh - 45px);
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="title">preopercionales combuses</div>
  </header>

  <main class="wrap">
    <div class="frame-wrap">
      <div class="loader"><div class="spinner" aria-label="Cargando…"></div></div>

      <!-- IFRame -->
      <iframe
        id="appscript"
        title="Mi WebApp"
        src="https://script.google.com/macros/s/AKfycbyMJujQe5cJcHtIxv8JVOxumAcJDcUaGxhVj6gYIxslpDMFB20LF9w6gxj0fDA5E7Ax/exec?embedded=1"
        allow="clipboard-read; clipboard-write; camera; microphone; geolocation; fullscreen"
        referrerpolicy="strict-origin-when-cross-origin"
        scrolling="yes"
      ></iframe>
    </div>
  </main>

  <script>
    // Marcar listo al cargar para ocultar el loader
    const iframe = document.getElementById('appscript');
    iframe.addEventListener('load', () => {
      document.body.classList.add('ready');
      // Inicializar scroll en móviles después de cargar
      initMobileScroll();
    });

    // Auto-ajuste de altura (funciona si la WebApp envía postMessage)
    const ALLOWED_ORIGINS = new Set([
      'https://script.google.com',
      'https://script.googleusercontent.com'
    ]);

    window.addEventListener('message', (ev) => {
      try {
        if (!ALLOWED_ORIGINS.has(ev.origin)) return;
      } catch { return; }

      if (ev.data && ev.data.type === 'appsScriptHeight') {
        const h = Math.max(320, Math.min(Number(ev.data.height || 0), 8000));
        iframe.style.height = h + 'px';
        // Para móviles, limitar la altura máxima
        if (isMobile()) {
          const maxHeight = window.innerHeight * 2; // Máximo 2 pantallas
          iframe.style.height = Math.min(h, maxHeight) + 'px';
          iframe.style.overflowY = 'auto';
        }
      }
    });

    // Detectar si es dispositivo móvil
    function isMobile() {
      return /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    }

    // Inicializar scroll para móviles
    function initMobileScroll() {
      if (!isMobile()) return;
      
      // Configurar iframe para scroll táctil
      iframe.style.webkitOverflowScrolling = 'touch';
      iframe.style.overflowY = 'scroll';
      
      // Prevenir comportamientos problemáticos del scroll
      document.body.style.overflow = 'hidden';
      document.body.style.height = '100%';
      
      // Ajustar altura inicial
      adjustIframeHeight();
      
      // Prevenir zoom con doble toque (solo en iframe)
      let lastTouchEnd = 0;
      iframe.addEventListener('touchend', (event) => {
        const now = Date.now();
        if (now - lastTouchEnd <= 300) {
          event.preventDefault();
        }
        lastTouchEnd = now;
      }, { passive: false });
    }

    // Ajustar altura del iframe
    function adjustIframeHeight() {
      if (isMobile()) {
        const headerHeight = document.querySelector('header').offsetHeight;
        const viewportHeight = window.innerHeight;
        const iframeHeight = viewportHeight - headerHeight;
        
        iframe.style.height = iframeHeight + 'px';
        iframe.style.minHeight = iframeHeight + 'px';
        
        // También ajustar el contenedor
        document.querySelector('.wrap').style.height = iframeHeight + 'px';
        document.querySelector('.frame-wrap').style.height = iframeHeight + 'px';
      }
    }

    // Ajustar en cambios de tamaño/orientación
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        adjustIframeHeight();
      }, 150);
    });

    window.addEventListener('orientationchange', () => {
      setTimeout(adjustIframeHeight, 300);
    });

    // Inicializar al cargar la página
    document.addEventListener('DOMContentLoaded', () => {
      adjustIframeHeight();
      // Fallback: si después de 3 segundos no hay auto-resize, usar altura por defecto
      setTimeout(() => {
        if (iframe.style.height === '100%') {
          adjustIframeHeight();
        }
      }, 3000);
    });

    // Fallback para navegadores que no soportan dvh
    function setViewportHeight(){
      if (!isMobile()) return;
      
      const vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
      
      const headerHeight = document.querySelector('header').offsetHeight;
      const calculatedHeight = window.innerHeight - headerHeight;
      
      iframe.style.minHeight = Math.max(calculatedHeight, 400) + 'px';
      document.querySelector('.wrap').style.height = calculatedHeight + 'px';
    }
    
    // Ejecutar al inicio y en resize
    setViewportHeight();
    window.addEventListener('resize', setViewportHeight);
  </script>
</body>
</html>


